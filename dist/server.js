var a=Object.defineProperty;var s=(e,o)=>a(e,"name",{value:o,configurable:!0});import{createServer as l}from"http";import{parse as g}from"url";import{CopilotRuntime as h,OpenAIAdapter as m,copilotRuntimeNodeHttpEndpoint as v,LangGraphAgent as I}from"@copilotkit/runtime";import d from"openai";import"dotenv/config";var n={port:parseInt(process.env.PORT||"3001",10),host:process.env.HOST||"0.0.0.0",nodeEnv:process.env.NODE_ENV||"development"},u=["OPENAI_API_KEY","OPENAI_API_BASE_URL"];for(let e of u)process.env[e]||(console.error(`\u274C \u7F3A\u5C11\u5FC5\u9700\u7684\u73AF\u5883\u53D8\u91CF: ${e}`),process.exit(1));var A=new d({apiKey:process.env.OPENAI_API_KEY,baseURL:process.env.OPENAI_API_BASE_URL}),E=new m({openai:A}),r=l((e,o)=>{let{pathname:p}=g(e.url||"",!0);if(p==="/health"){let c={status:"healthy",timestamp:new Date().toISOString(),...process.env.npm_package_version?{version:process.env.npm_package_version}:{}};o.writeHead(200,{"Content-Type":"application/json","Cache-Control":"no-cache"}),o.end(JSON.stringify(c,null,2));return}let i=new h({agents:{agent:new I({deploymentUrl:process.env.LANGGRAPH_URL||"http://langgraph:8123",graphId:"agent",langsmithApiKey:process.env.LANGSMITH_API_KEY||"",description:"\u7B80\u5355\u804A\u5929\u4EE3\u7406"})}});return v({endpoint:"/copilotkit",runtime:i,serviceAdapter:E})(e,o)});r.listen(n.port,n.host,()=>{console.log(`\u{1F680} CopilotKit \u670D\u52A1\u8FD0\u884C\u5728 http://${n.host}:${n.port}/copilotkit`),console.log(`\u{1F50D} \u5065\u5EB7\u68C0\u67E5\u7AEF\u70B9: http://${n.host}:${n.port}/health`),console.log(`\u{1F30D} \u73AF\u5883: ${n.nodeEnv}`)});var t=s(e=>{console.log(`
\u{1F4E1} \u6536\u5230 ${e} \u4FE1\u53F7\uFF0C\u6B63\u5728\u4F18\u96C5\u5173\u95ED...`),r.close(o=>{o&&(console.error("\u274C \u5173\u95ED\u670D\u52A1\u5668\u65F6\u51FA\u9519:",o),process.exit(1)),console.log("\u2705 HTTP \u670D\u52A1\u5668\u5DF2\u5173\u95ED"),process.exit(0)}),setTimeout(()=>{console.error("\u26A0\uFE0F  \u5F3A\u5236\u5173\u95ED\u8D85\u65F6\uFF0C\u7ACB\u5373\u9000\u51FA"),process.exit(1)},1e4)},"gracefulShutdown");process.on("SIGTERM",()=>t("SIGTERM"));process.on("SIGINT",()=>t("SIGINT"));process.on("uncaughtException",e=>{console.error("\u274C \u672A\u6355\u83B7\u7684\u5F02\u5E38:",e),t("uncaughtException")});process.on("unhandledRejection",(e,o)=>{console.error("\u274C \u672A\u5904\u7406\u7684Promise\u62D2\u7EDD:",e,"at:",o),t("unhandledRejection")});export{r as server};
//# sourceMappingURL=server.js.map