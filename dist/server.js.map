{"version":3,"sources":["../src/server.ts"],"sourcesContent":["import {\n  createServer,\n  type IncomingMessage,\n  type ServerResponse,\n} from \"node:http\";\nimport { parse } from \"node:url\";\nimport {\n  CopilotRuntime,\n  OpenAIAdapter,\n  copilotRuntimeNodeHttpEndpoint,\n  LangGraphAgent,\n} from \"@copilotkit/runtime\";\nimport OpenAI from \"openai\";\nimport \"dotenv/config\";\n\n// Á±ªÂûãÂÆö‰πâ\ninterface HealthResponse {\n  status: string;\n  timestamp: string;\n  version?: string;\n}\n\ninterface ServerConfig {\n  port: number;\n  host: string;\n  nodeEnv: string;\n}\n\n// ÈÖçÁΩÆ\nconst config: ServerConfig = {\n  port: parseInt(process.env.PORT || \"3001\", 10),\n  host: process.env.HOST || \"0.0.0.0\",\n  nodeEnv: process.env.NODE_ENV || \"development\",\n};\n\n// È™åËØÅÂøÖÈúÄÁöÑÁéØÂ¢ÉÂèòÈáè\nconst requiredEnvVars = [\"OPENAI_API_KEY\", \"OPENAI_API_BASE_URL\"];\nfor (const envVar of requiredEnvVars) {\n  if (!process.env[envVar]) {\n    console.error(`‚ùå Áº∫Â∞ëÂøÖÈúÄÁöÑÁéØÂ¢ÉÂèòÈáè: ${envVar}`);\n    process.exit(1);\n  }\n}\n\n// ÂàùÂßãÂåñ OpenAI ÂÆ¢Êà∑Á´Ø\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY!,\n  baseURL: process.env.OPENAI_API_BASE_URL!,\n});\n\nconst serviceAdapter = new OpenAIAdapter({ openai });\n\n// ÂàõÂª∫ÊúçÂä°Âô®\nconst server = createServer((req: IncomingMessage, res: ServerResponse) => {\n  const { pathname } = parse(req.url || \"\", true);\n\n  // ÂÅ•Â∫∑Ê£ÄÊü•Á´ØÁÇπ\n  if (pathname === \"/health\") {\n    const healthResponse: HealthResponse = {\n      status: \"healthy\",\n      timestamp: new Date().toISOString(),\n      ...(process.env.npm_package_version\n        ? { version: process.env.npm_package_version }\n        : {}),\n    };\n\n    res.writeHead(200, {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-cache\",\n    });\n    res.end(JSON.stringify(healthResponse, null, 2));\n    return;\n  }\n\n  // CopilotKit ËøêË°åÊó∂\n  const runtime = new CopilotRuntime({\n    agents: {\n      agent: new LangGraphAgent({\n        deploymentUrl: process.env.LANGGRAPH_URL || \"http://langgraph:8123\",\n        graphId: \"agent\",\n        langsmithApiKey: process.env.LANGSMITH_API_KEY || \"\",\n        description: \"ÁÆÄÂçïËÅäÂ§©‰ª£ÁêÜ\",\n      }),\n    },\n  });\n\n  const handler = copilotRuntimeNodeHttpEndpoint({\n    endpoint: \"/copilotkit\",\n    runtime,\n    serviceAdapter,\n  });\n\n  return handler(req, res);\n});\n\n// ÂêØÂä®ÊúçÂä°Âô®\nserver.listen(config.port, config.host, () => {\n  console.log(\n    `üöÄ CopilotKit ÊúçÂä°ËøêË°åÂú® http://${config.host}:${config.port}/copilotkit`\n  );\n  console.log(`üîç ÂÅ•Â∫∑Ê£ÄÊü•Á´ØÁÇπ: http://${config.host}:${config.port}/health`);\n  console.log(`üåç ÁéØÂ¢É: ${config.nodeEnv}`);\n});\n\n// ‰ºòÈõÖÂÖ≥Èó≠Â§ÑÁêÜ\nconst gracefulShutdown = (signal: string) => {\n  console.log(`\\nüì° Êî∂Âà∞ ${signal} ‰ø°Âè∑ÔºåÊ≠£Âú®‰ºòÈõÖÂÖ≥Èó≠...`);\n\n  server.close((err) => {\n    if (err) {\n      console.error(\"‚ùå ÂÖ≥Èó≠ÊúçÂä°Âô®Êó∂Âá∫Èîô:\", err);\n      process.exit(1);\n    }\n\n    console.log(\"‚úÖ HTTP ÊúçÂä°Âô®Â∑≤ÂÖ≥Èó≠\");\n    process.exit(0);\n  });\n\n  // Âº∫Âà∂ÂÖ≥Èó≠Ë∂ÖÊó∂\n  setTimeout(() => {\n    console.error(\"‚ö†Ô∏è  Âº∫Âà∂ÂÖ≥Èó≠Ë∂ÖÊó∂ÔºåÁ´ãÂç≥ÈÄÄÂá∫\");\n    process.exit(1);\n  }, 10000);\n};\n\n// ‰ø°Âè∑Â§ÑÁêÜ\nprocess.on(\"SIGTERM\", () => gracefulShutdown(\"SIGTERM\"));\nprocess.on(\"SIGINT\", () => gracefulShutdown(\"SIGINT\"));\n\n// Êú™ÊçïËé∑ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ\nprocess.on(\"uncaughtException\", (err) => {\n  console.error(\"‚ùå Êú™ÊçïËé∑ÁöÑÂºÇÂ∏∏:\", err);\n  gracefulShutdown(\"uncaughtException\");\n});\n\nprocess.on(\"unhandledRejection\", (reason, promise) => {\n  console.error(\"‚ùå Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù:\", reason, \"at:\", promise);\n  gracefulShutdown(\"unhandledRejection\");\n});\n\nexport { server };\n"],"mappings":"+EAAA,OACE,gBAAAA,MAGK,OACP,OAAS,SAAAC,MAAa,MACtB,OACE,kBAAAC,EACA,iBAAAC,EACA,kCAAAC,EACA,kBAAAC,MACK,sBACP,OAAOC,MAAY,SACnB,MAAO,gBAgBP,IAAMC,EAAuB,CAC3B,KAAM,SAAS,QAAQ,IAAI,MAAQ,OAAQ,EAAE,EAC7C,KAAM,QAAQ,IAAI,MAAQ,UAC1B,QAAS,QAAQ,IAAI,UAAY,aACnC,EAGMC,EAAkB,CAAC,iBAAkB,qBAAqB,EAChE,QAAWC,KAAUD,EACd,QAAQ,IAAIC,CAAM,IACrB,QAAQ,MAAM,kEAAgBA,CAAM,EAAE,EACtC,QAAQ,KAAK,CAAC,GAKlB,IAAMC,EAAS,IAAIC,EAAO,CACxB,OAAQ,QAAQ,IAAI,eACpB,QAAS,QAAQ,IAAI,mBACvB,CAAC,EAEKC,EAAiB,IAAIC,EAAc,CAAE,OAAAH,CAAO,CAAC,EAG7CI,EAASC,EAAa,CAACC,EAAsBC,IAAwB,CACzE,GAAM,CAAE,SAAAC,CAAS,EAAIC,EAAMH,EAAI,KAAO,GAAI,EAAI,EAG9C,GAAIE,IAAa,UAAW,CAC1B,IAAME,EAAiC,CACrC,OAAQ,UACR,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,GAAI,QAAQ,IAAI,oBACZ,CAAE,QAAS,QAAQ,IAAI,mBAAoB,EAC3C,CAAC,CACP,EAEAH,EAAI,UAAU,IAAK,CACjB,eAAgB,mBAChB,gBAAiB,UACnB,CAAC,EACDA,EAAI,IAAI,KAAK,UAAUG,EAAgB,KAAM,CAAC,CAAC,EAC/C,MACF,CAGA,IAAMC,EAAU,IAAIC,EAAe,CACjC,OAAQ,CACN,MAAO,IAAIC,EAAe,CACxB,cAAe,QAAQ,IAAI,eAAiB,wBAC5C,QAAS,QACT,gBAAiB,QAAQ,IAAI,mBAAqB,GAClD,YAAa,sCACf,CAAC,CACH,CACF,CAAC,EAQD,OANgBC,EAA+B,CAC7C,SAAU,cACV,QAAAH,EACA,eAAAT,CACF,CAAC,EAEcI,EAAKC,CAAG,CACzB,CAAC,EAGDH,EAAO,OAAOP,EAAO,KAAMA,EAAO,KAAM,IAAM,CAC5C,QAAQ,IACN,8DAA8BA,EAAO,IAAI,IAAIA,EAAO,IAAI,aAC1D,EACA,QAAQ,IAAI,0DAAqBA,EAAO,IAAI,IAAIA,EAAO,IAAI,SAAS,EACpE,QAAQ,IAAI,2BAAUA,EAAO,OAAO,EAAE,CACxC,CAAC,EAGD,IAAMkB,EAAmBC,EAACC,GAAmB,CAC3C,QAAQ,IAAI;AAAA,yBAAWA,CAAM,4DAAe,EAE5Cb,EAAO,MAAOc,GAAQ,CAChBA,IACF,QAAQ,MAAM,2DAAeA,CAAG,EAChC,QAAQ,KAAK,CAAC,GAGhB,QAAQ,IAAI,kDAAe,EAC3B,QAAQ,KAAK,CAAC,CAChB,CAAC,EAGD,WAAW,IAAM,CACf,QAAQ,MAAM,kFAAiB,EAC/B,QAAQ,KAAK,CAAC,CAChB,EAAG,GAAK,CACV,EAlByB,oBAqBzB,QAAQ,GAAG,UAAW,IAAMH,EAAiB,SAAS,CAAC,EACvD,QAAQ,GAAG,SAAU,IAAMA,EAAiB,QAAQ,CAAC,EAGrD,QAAQ,GAAG,oBAAsBG,GAAQ,CACvC,QAAQ,MAAM,+CAAaA,CAAG,EAC9BH,EAAiB,mBAAmB,CACtC,CAAC,EAED,QAAQ,GAAG,qBAAsB,CAACI,EAAQC,IAAY,CACpD,QAAQ,MAAM,sDAAoBD,EAAQ,MAAOC,CAAO,EACxDL,EAAiB,oBAAoB,CACvC,CAAC","names":["createServer","parse","CopilotRuntime","OpenAIAdapter","copilotRuntimeNodeHttpEndpoint","LangGraphAgent","OpenAI","config","requiredEnvVars","envVar","openai","OpenAI","serviceAdapter","OpenAIAdapter","server","createServer","req","res","pathname","parse","healthResponse","runtime","CopilotRuntime","LangGraphAgent","copilotRuntimeNodeHttpEndpoint","gracefulShutdown","__name","signal","err","reason","promise"]}